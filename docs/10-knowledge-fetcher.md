# 10 — knowledge-fetcher 专用子代理（补课/查资料不污染主上下文）

## 目标
把“补课/检索/引用整理”这类高噪声工作交给专用流程处理，并以**节省主模型 token**为优先：
- 默认优先外包（尤其是不着急、重任务、长任务）
- 主会话只接收 **结构化结论 + 关键引用**
- 避免把大量原始材料灌进主会话上下文

## 决策策略（默认）

### 默认优先外包给 opencode（token 优化优先）
满足任一即可优先外包：
- 任务不着急（允许异步）
- 预计会消耗大量 token（长检索、长写作、多轮汇总）
- 任务多但偏机械（整理、归并、批量提取、格式化）

### 保留在主会话/本地子代理的例外
- 需要即时互动（秒级往返）
- 高风险决策（权限、资金、生产改动）需主会话直接把关
- 涉及敏感信息（token/PAT/cookie/私密数据）不外包
- 小任务且外包摩擦大于收益

## 标准产出格式（外包/子代理必须交付）
- TL;DR（<= 10 行）
- 关键步骤（bullet list，可执行）
- 风险/边界（什么时候不要做/需要人确认）
- 引用（2~5 条）：每条包含 URL + 摘录（尽量短）
- 建议下一步：主会话应该做什么

## 工作流 A：OpenClaw 子代理 + idx.md（轻量补课）
1) 主会话判断需要补课 → `sessions_spawn` 启动子代理
2) 子代理：
   - `web_fetch(idx.md/index.md)` 选 topic
   - 拉 HEAD/BODY（必要时校验 sha256；推荐用本地脚本缓存）
   - 读 BODY 只摘必要段落
3) 子代理按“标准产出格式”回传
4) 主会话验收：spot check 2~3 条引用，再输出最终答案/写入手册

## 工作流 B：外包给 OpenCode（默认优先于 A，当任务重且不急）
- 优点：省主模型 token、长任务不阻塞主会话、可并行检索+写作
- 代价：多一层系统/模型，验收成本更高

### opencode 外包要求
- 输入：只给公开材料的 URL / idx.md topic；不要给 secrets/memory
- 输出：必须包含引用与可复核链接
- 主会话验收：对关键结论做 spot check

（opencode 外包执行模板见：`docs/08-opencode-outsourcing.md`）

## 安全边界
- 子代理/外包都**禁止**接触 token/PAT/cookie/credentials
- 只处理公开材料；涉及私密内容必须先脱敏再交付
